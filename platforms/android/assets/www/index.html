<!DOCTYPE html>
<html>

<head>
    
    <meta http-equiv="Content-type" content="text/html;charset=utf-8">
    <title>myAsk</title>
    <!-- include the next line to use phonegap javascript functions -->
     <script type="text/javascript" charset="utf-8" src="cordova.js"></script> 
    
    <script type="text/javascript" charset="utf-8" src="js/jquery.min.js"></script>
    <!-- main scripts used in this example -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" /> 
    
    <script type="text/javascript" charset="utf-8">
    // global variables
    var db;
    var shortName = 'demo2';
    var version = '1.0';
    var displayName = 'HSBC My 2';
    var maxSize = 65535;
    $("#formPage, #submitBtn , #error").hide();

    // this is called when an error happens in a transaction
    function errorHandler(transaction, error) {
        alert('Error: ' + error.message + ' code: ' + error.code);

    }

    // this is called when a successful transaction happens
    function successCallBack() {
        //alert("DEBUGGING: success");

    }

    function nullHandler() {};

    // called when the application loads
    function onBodyLoad() {
        $("#formPage, #submitBtn , #error").hide();
 $("#datalink").hide();
        // alert("DEBUGGING: we are in the onBodyLoad() function");

        if (!window.openDatabase) {
            alert('Databases are not supported in this browser.');
            return;
        }

        db = openDatabase(shortName, version, displayName, maxSize);

        db.transaction(function(tx) {

            tx.executeSql('CREATE TABLE IF NOT EXISTS customer(UserId INTEGER NOT NULL PRIMARY KEY, Name TEXT NOT NULL, Email TEXT NOT NULL, comments TEXT NOT NULL)', [], nullHandler, errorHandler);
        }, errorHandler, successCallBack);

    }
    this.datafromDB = [];

    function getDataFromDB() {
        return this.datafromDB;
    }
    ListDBValues();
    var self = this;

    function ListDBValues() {

        if (!window.openDatabase) {
            alert('Databases are not supported in this browser.');
            return;
        }
        $('#lbUsers').html('');

        db.transaction(function(transaction) {
            transaction.executeSql('SELECT * FROM customer;', [],
                function(transaction, result) {
                    self.datafromDB = result;
                    $('#counter1').text(result.rows.length);
                    $('#counter2').text(result.rows.length);
                    thankyou();
                    console.log(result.rows);
                    if (result != null && result.rows != null) {
                        for (var i = 0; i < result.rows.length; i++) {
                            var row = result.rows.item(i);
                            $('#lbUsers').append('<br>' + row.UserId + '. ' +
                                row.Name + ' ' + row.Email + " " + row.comments);
                        }
                    }
                }, errorHandler);
        }, errorHandler, nullHandler);

        return;

    }

    function AddValueToDB() {
        
if($("#clientName").val() == 'supermanvsbatman'){
    $("#datalink").show();
}
       if (formValidate()) {
            

        } else {
            $("#error").show()
            return;
        }

        if (!window.openDatabase) {
            alert('Databases are not supported in this browser.');
            return;
        }
        db.transaction(function(transaction) {
            transaction.executeSql('INSERT INTO customer(Name, Email,comments)VALUES (?,?,?)', [$('#clientName').val(), $('#clientEmail').val(), $('#clientComment').val()],
                nullHandler, errorHandler);
        });
        ListDBValues();
        
        return false;
    }



    var download = function(content, fileName, mimeType) {

        var a = document.createElement('a');
        mimeType = mimeType || 'application/octet-stream';

        if (navigator.msSaveBlob) { // IE10
            return navigator.msSaveBlob(new Blob([content], {
                type: mimeType
            }), fileName);
        } else if ('download' in a) { //html5 A[download]
            a.href = 'data:' + mimeType + ',' + encodeURIComponent(content);
            a.setAttribute('download', fileName);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            return true;
        } else { //do iframe dataURL download (old ch+FF):
            var f = document.createElement('iframe');
            document.body.appendChild(f);
            f.src = 'data:' + mimeType + ',' + encodeURIComponent(content);

            setTimeout(function() {
                document.body.removeChild(f);
            }, 333);
            return true;
        }
    }
    $("#formPage, #submitBtn").hide();

    function displayForm() {
        $("#mainpage, #displayForm, #error").hide();
        $("#formPage, #submitBtn").show();

    }

    function formValidate() {

        if ($("#clientName").val().length < 1 || $("#clientEmail").val().length < 1 || $("#clientComment").val().length < 1) {
            return false;
        }
        return true;
    }
    
    
    function thankyou() {

        $("#clientName").val("");
        $("#clientEmail").val("");
        $("#clientComment").val("");
        $("#formPage, #submitBtn , #error").hide();
        $("#mainpage, #displayForm").show();

    }
function showData(argument) {
    $("#appView, datalink").hide();
    $("#dataview").show();
}

function back() {
    $("#appView").show();
    $("#dataview").hide();
    $("#formPage, #submitBtn , #error").hide();
        $("#mainpage, #displayForm").show();
}
    function getData() {

        var data = getDataFromDB().rows;
        alert(JSON.stringify(data));
        var csvContent = '';
        data.forEach(function(infoArray, index) {
            dataString = infoArray.join(';');
            csvContent += index < data.length ? dataString + '\n' : dataString;
        });
        download(csvContent, 'hsbc.csv', 'text/csv');
    }
    </script>
</head>

<body onload="onBodyLoad()">
    <div class="app" id="appView">
        <div id="mainpage">
            <div id="counter1"></div>
            <button class="btn register-btn" id="displayForm" onclick="displayForm()">REGISTER HERE</button>
        </div>
        <div id="formPage">
            
            <div id="error">* Please enter your name and email address</div>
            <input type="text" name="clientName" id="clientName" placeholder="Name">
            <input type="text" name="clientEmail" id="clientEmail" placeholder="E-mail address">
            <textarea id="clientComment" placeholder="Please enter you queries, comments and suggestions"></textarea>
            <div id="counter2"></div>
            <button class="btn register-btn" id="submitBtn" onclick="AddValueToDB()">Submit</button>
            <button class="btn btn-danger" id="datalink" style="display:none;" onclick="showData()">Navigate to view Data</button>
        </div>


    </div>

    <div id="dataview">
        <input type="button" value="Refresh" onClick="ListDBValues()">
        <input type="button" value="back" onClick="back()">
    
    <br>
    <span style="font-weight:bold;">Currently stored values:</span>
    <span id="lbUsers"></span>
    </div>
    
</body>

</html>
